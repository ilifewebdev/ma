# 可爱风赛马 H5 小游戏 - 进阶版策划案 (v4.1)

**适用人群**：小学 3–4 年级（8–10 岁）
**游戏类型**：横版闯关跑酷
**当前版本**：v4.1 (含部署自动化、经济数值模型、GitHub Pages 上线)

---

## 一、 核心玩法升级

### 1. 闯关模式 (基础)
*   **关卡制**：共设 **10 个独立关卡**，难度循序渐进。
*   **解锁机制**：玩家必须通关当前关卡（到达目标距离），才能解锁下一关。
*   **地图系统**：首页为 **冒险地图**，直观展示关卡进度（5x2 网格布局）。

### 2. 无尽模式 (♾ Endless Mode)
*   **解锁方式**：完成一次普通关卡（跑到终点）后解锁。
*   **入口**：首页地图顶部「♾ 快乐无限跑」按钮。
*   **核心规则**：
    *   无终点，只记录“本次跑了多远”。
    *   **动态难度**：障碍频率随距离缓慢增加，每 500 米轻微加速。
*   **结算反馈**：
    *   不显示排名，仅对比“本次距离”与“历史最佳”。
    *   **文案**：“太棒啦！你比上次多跑了 120 米 🎉”、“这次先跑到这里～下次一定更远！”。

### 3. 操作进阶
*   **跳跃**：点击屏幕 / 空格键 / 上滑。
*   **二段跳**：空中再次点击。
*   **滑铲**：下滑 / 下方向键。
*   **左右移动**：⬅️ / ➡️ 方向键（**v3.1新增**，可前后移动灵活走位）。
*   **暂停**：点击 HUD 右上角暂停按钮，可暂停游戏、继续或退出。
*   **新手引导 (v4.0新增)**：第一关加入动态手指引导，手把手教玩家“跳跃”和“滑铲”。

---

## 二、 角色系统 (小马宝莉主题) - **NEW v4.0**

游戏角色全面更新为《小马宝莉》经典角色，每个角色拥有独特能力。

| 角色 | 原型 | 颜色 | 特殊能力 | 解锁条件 |
| :--- | :--- | :--- | :--- | :--- |
| **苹果嘉儿** | Applejack | 橙身/黄鬃 | **无特殊能力** (基础款) | 免费 |
| **瑞瑞** | Rarity | 白身/紫鬃 | **跳跃高度 +5%** (优雅) | 100 金币 |
| **云宝** | Rainbow Dash | 蓝身/彩虹鬃 | **金币收益 +10%** (极速) | 200 金币 |
| **泽科拉** | Zecora | 斑马条纹 | **奔跑速度感 +10%** (神秘) | 300 金币 |
| **碧琪** | Pinkie Pie | 粉身/粉鬃 | **护盾持续时间 +20%** (快乐) | 500 金币 |
| **紫悦公主** | Twilight Sparkle | 紫身/紫鬃 | **开局自带磁铁** (魔法) | 1000 金币 |

---

## 三、 道具系统 (趣味变身)

新增体型变化道具，增加游戏策略性。

| 道具 | 图标 | 效果 | 表现 | 持续时间 |
| :--- | :--- | :--- | :--- | :--- |
| **蘑菇** (变大) | 🍄 | 体型变大 1.6 倍，**撞碎地面障碍**。 | 巨大化小马，撞击障碍有碎裂特效。 | 10秒 |
| **药水** (变小) | 🧪 | 体型缩小 0.6 倍，**直接钻过空中障碍**。 | 迷你小马，无需滑铲即可通过。 | 10秒 |
| **磁铁** | 🧲 | 自动吸附附近的爱心/星星。 | 小马周围柔光圈，道具飘向小马。 | 6秒 |
| **护盾** | 🛡️ | 抵挡 1 次撞击，不扣爱心。 | 透明泡泡包裹小马，撞击时破碎。 | 直至被击破 |
| **爱心** | 💖 | 恢复 1 点生命值。 | 经典红心。 | 瞬间生效 |
| **星星** | 🌟 | **复活祝福**（v3.2新增）。 | 获得光环，死后瞬间满血复活。 | 直至消耗 |

---

## 四、 关卡与主题设计 (沉浸式体验)

**全场景障碍物动物化 & 动态化**：所有地面障碍物不再静止，均有跳跃、爬行等动画。
**氛围增强**：每个场景增加独特的天气/环境粒子效果，以及**定制化背景层**（云朵、山脉、建筑等）。

| 关卡 | 主题 | 目标 | 特色障碍 (动物化) | 背景特色 | Boss |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **1** | 🌿 草原 | 500m | 🐇 兔子 (跳) / 🐝 蜜蜂 | 青山、绿树、蓝天 | 🐻 熊 (扔蜂蜜) |
| **2** | 🏖️ 海滩 | 750m | 🦀 螃蟹 (跳) / 🕊️ 海鸥 | 椰树、海浪、白云 | 🦈 鲨鱼 (喷水) |
| **3** | 🚜 农场 | 1000m | 🐔 鸡 (跳) / 🦅 乌鸦 | 谷仓、麦田、黄昏 | 🦊 狐狸 (扔蛋) |
| **4** | 🏢 城市 | 1250m | 🐁 老鼠 (跑) / 🚁 无人机 | 高楼、夜景、灯光 | 🦖 恐龙 (扔骨头) |
| **5** | 🌵 沙漠 | 1500m | 🐍 蛇 (爬) / 🦅 秃鹫 | 金字塔、沙丘、烈日 | 🦂 蝎子 (扔仙人掌) |
| **6** | ⛄ 雪地 | 1750m | 🐧 企鹅 (摇摆) / 🦉 猫头鹰 | 雪山、松林、飘雪 | 🦁 雪狮 (扔雪球) |
| **7** | 🌲 森林 | 2000m | 🐿️ 松鼠 (跳) / 🦇 蝙蝠 | 密林、深绿天幕 | 🐻 熊 (复刻) |
| **8** | 🌋 火山 | 2250m | 🦎 蜥蜴 (爬) / 🔥 火球 | 火山群、暗红天空 | 🐲 火龙 (喷火球) |
| **9** | 🚀 太空 | 2500m | 👾 外星人 (浮) / 🛸 UFO | 行星、星环、深空 | 👾 外星人 (激光) |
| **10** | 🌈 彩虹 | 3000m | 🐢 乌龟 (爬) / 🦄 独角兽 | 粉色云朵、梦幻天空 | 🦄 独角兽 (魔法) |

---

## 五、 v4.0 技术与体验重大升级

### 1. 代码架构重构
*   **模块化设计**：将原本臃肿的 `game.js` 拆分为 13+ 个独立模块（`Player.js`, `Boss.js`, `UIManager.js` 等）。
*   **可维护性**：逻辑清晰，便于后续添加新角色、新道具或新关卡。

### 2. 音效系统升级 (Audio Upgrade)
*   **MP3 支持**：引入 `AudioController.js`，支持加载外部 MP3 音效（跳跃、金币、碰撞、BGM）。
*   **合成器回退**：若 MP3 加载失败，自动回退到 Web Audio API 合成音效，确保游戏在任何网络环境下均有声音。

### 3. 社交分享 (Social Share)
*   **战绩生成**：结算页面新增“晒战绩”功能。
*   **动态海报**：使用 Canvas 实时生成包含当前分数、关卡主题背景、玩家角色形象及昵称（"[昵称] 的小马王国"）的精美图片。
*   **长按保存**：支持移动端长按保存图片分享至朋友圈。

### 4. 新手引导 (Tutorial)
*   **动态手指**：第一关（草原）新增动态手指动画。
*   **智能触发**：检测前方障碍物类型，智能提示“点击跳跃”或“下滑躲避”。
*   **二段跳教学**：在合适的时机提示玩家进行二段跳。

### 5. 账号与日历系统 (Account & Calendar)
*   **多用户存档**：新增登录界面，支持输入昵称创建独立存档，一台设备可供多人游玩。
*   **自动登录**：若本地已有昵称记录，再次进入游戏时将自动登录，无需重复输入。
*   **切换账号**：地图界面右上角新增“切换账号”按钮，方便退出或更换玩家。
*   **冒险日历**：首页新增日历入口，记录每日奔跑距离、挑战次数及**当日最高到达关卡**。
*   **日历成就**：新增“坚持不懈”（3天打卡）和“每日马拉松”（单日5000米）等专属成就。

---

## 六、 经济数值模型 (Economic Model) - **NEW v4.1**

为了保证游戏的耐玩性，我们建立了基础的经济循环。

### 1. 产出 (金币获取)
*   **关卡内收集**：每局平均可收集 **20-40** 金币。
*   **通关奖励**：完成关卡额外奖励 **50** 金币。
*   **无尽模式**：每跑 1000 米奖励 **50** 金币。
*   **云宝加成**：使用角色“云宝”可获得 **10%** 额外收益。

### 2. 消耗 (角色购买)
*   **入门级 (100-200金币)**：瑞瑞、云宝。玩家游玩 **3-5 局** 即可解锁第一个角色，建立早期成就感。
*   **进阶级 (300-500金币)**：泽科拉、碧琪。需要玩家持续游玩 **10-15 局**，作为中期目标。
*   **终极级 (1000金币)**：紫悦公主。长期目标，象征“大师”身份，需要玩家通关大部分关卡并积累财富。

---

## 七、 技术部署与运维 (Deployment & DevOps) - **NEW v4.1**

### 1. 托管方案
*   **平台**：GitHub Pages (https://ilifewebdev.github.io/ma/)
*   **优势**：免费、全球 CDN 加速、HTTPS 安全认证。
*   **适配**：已修复静态资源相对路径问题 (`./js/`)，完美支持子目录托管。

### 2. 自动化部署
*   **Windows**：提供 `update_github.bat` 脚本，双击即可完成 `add` -> `commit` -> `push` 全流程。
*   **Mac/Linux**：提供 `update_github.sh` 脚本，具备同等功能。
*   **版本控制**：完整记录代码变更历史，便于回滚。

---

## 八、 项目完整性评估 (Project Completeness Assessment)

### ✅ 已完成功能 (v4.1 Stable)
1.  **核心玩法**：跑酷、跳跃、滑铲、二段跳、碰撞检测、生命值系统。
2.  **关卡系统**：10个差异化关卡、地图解锁机制、无尽模式。
3.  **角色系统**：6个可解锁的小马宝莉角色，具备差异化数值/能力。
4.  **敌人系统**：地面/空中动态敌人、Boss战（投掷物、追逐）。
5.  **道具系统**：6种道具（含变身、复活）。
6.  **UI/UX**：
    *   **账号体系**：支持多用户存档、自动登录、一键切换账号。
    *   **界面交互**：完整的开始、地图、HUD、暂停、结算、商店、成就、帮助、分享、日历界面。
    *   **视觉反馈**：粒子特效、Toast提示、动态背景、角色预览。
7.  **音效**：
    *   **双模引擎**：支持外部 MP3 资源加载。
    *   **智能回退**：若资源缺失，自动切换至 Web Audio API 合成音效，保证 100% 声音覆盖。
8.  **数据与存档**：本地存储（LocalStorage）保存多用户进度、金币、皮肤解锁状态、日历记录。
9.  **社交与留存**：
    *   **分享**：生成带有昵称、角色、成绩的专属海报。
    *   **日历**：每日打卡记录，最高关卡追踪，专属日历成就。
10. **部署**：
    *   GitHub Pages 自动化部署脚本。
    *   跨平台路径适配。

### 🚧 待优化/未来计划 (v5.0 Outlook)
1.  **PWA 支持**：配置 `manifest.json` 和 Service Worker，让用户可以**把游戏安装到手机桌面**，离线也能玩。
2.  **美术资源升级**：将 Canvas 纯代码绘制升级为 **Sprite (精灵图)** 动画，提升角色动作流畅度和画面精细度。
3.  **在线排行榜**：接入轻量级后端（如 Firebase 或 LeanCloud），实现全球玩家分数排行。

---

**文档更新时间**：2026-02-09 (v4.1 Deployment Update)
